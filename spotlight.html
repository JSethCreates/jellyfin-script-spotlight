<!DOCTYPE html>
<html>
<head>
    <title>Jellyfin Spotlight</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        .slide { position: relative; width: 100vw; height: 100vh; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); cursor: pointer; outline: none; }
        .slide:focus { outline: 2px solid #fff; }
        .backdrop { position: absolute; top: 50px; left: 0; width: 100%; height: calc(100% - 50px); object-fit: cover; object-position: center 20%; border-radius: 5px; z-index: 1; }
        .logo { position: absolute; top: 65%; left: 10px; transform: translateY(-50%); max-height: 50%; max-width: 30%; width: auto; z-index: 3; }
        .plot { position: absolute; bottom: 0; left: 0; right: 0; color: white; width: 100%; font-family: 'Noto Sans', sans-serif; font-size: 15px; background: linear-gradient(to top, rgba(0, 0, 0, 1) 20%, rgba(0, 0, 0, 0) 100%); padding: 10px; border-radius: 5px; z-index: 4; box-sizing: border-box; }
        .featured-content { position: absolute; top: 0; left: 0; width: 100%; height: 50px; background-color: transparent; font-family: 'Noto Sans', sans-serif; color: #D3D3D3; font-size: 22px; display: flex; align-items: center; justify-content: flex-start; z-index: 2; padding: 10px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div id="slides-container"></div>
    <script>
        let title = 'Spotlight', type = 2, shuffleInterval = 10000, plotMaxLength = 240, userId = '0e0755005f074a59bc0108cc2c3e650b', token = 'de81a85d55024d7b9fa7b11031de7539';

        function truncateText(el, len) { if (el.textContent.length > len) el.textContent = el.textContent.substr(0, len) + '...'; }

        function createSlideElement(movie) {
            const slide = document.createElement('div'); slide.className = 'slide';
            slide.innerHTML = `
                <img class="backdrop" src="/Items/${movie.Id}/Images/Backdrop/0" alt="Backdrop">
                <img class="logo" src="/Items/${movie.Id}/Images/Logo" alt="Logo">
                <div class="featured-content">${title}</div>
                <div class="plot">${truncateText(document.createElement('div').textContent = movie.Overview, plotMaxLength)}</div>
            `;
            document.getElementById('slides-container').innerHTML = ''; 
            document.getElementById('slides-container').appendChild(slide);
        }

        function fetchRandomMovie() {
            let itemTypes = type === 1 ? 'Movie' : type === 2 ? 'Series' : 'Movie,Series';
            fetch(`/Users/${userId}/Items?IncludeItemTypes=${itemTypes}&Recursive=true&Limit=1&Fields=Id`, { headers: { 'Authorization': `MediaBrowser Client="Jellyfin Web", Device="YourDeviceName", DeviceId="YourDeviceId", Version="YourClientVersion", Token="${token}"` } })
                .then(response => response.json())
                .then(data => {
                    const maxIndex = Math.min(data.TotalRecordCount - 1, 2000);
                    return fetch(`/Users/${userId}/Items?IncludeItemTypes=${itemTypes}&Recursive=true&Limit=1&StartIndex=${Math.floor(Math.random() * (maxIndex + 1))}&Fields=Id,Overview`, { headers: { 'Authorization': `MediaBrowser Client="Jellyfin Web", Device="YourDeviceName", DeviceId="YourDeviceId", Version="YourClientVersion", Token="${token}"` } });
                })
                .then(response => response.json())
                .then(data => {
                    if (data.Items.length) checkBackdropAndLogo(data.Items[0]);
                    else fetchRandomMovie();
                })
                .catch(() => fetchRandomMovie());
        }

        function checkBackdropAndLogo(movie) {
            fetch(`/Items/${movie.Id}/Images/Backdrop/0`, { method: 'HEAD' })
                .then(response => response.ok ? fetch(`/Items/${movie.Id}/Images/Logo`, { method: 'HEAD' }) : Promise.reject())
                .then(response => response.ok ? createSlideElement(movie) : Promise.reject())
                .catch(() => fetchRandomMovie());
        }

        function initializeSlideshow() {
            fetchRandomMovie();
            setInterval(fetchRandomMovie, shuffleInterval);
        }

        document.addEventListener('DOMContentLoaded', initializeSlideshow);
    </script>
</body>
</html>
